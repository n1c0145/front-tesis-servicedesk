<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 p-4">
  <mat-card class="w-full max-w-2xl shadow-2xl rounded-2xl overflow-hidden">
    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-6 text-center">
      <div class="flex justify-center mb-4">
        <div class="bg-white p-3 rounded-full">
          <mat-icon class="text-blue-600 scale-125">lock_reset</mat-icon>
        </div>
      </div>
      <h1 class="text-2xl font-bold text-white mb-2">Recuperar Contraseña</h1>
      <p class="text-blue-100">Sigue los pasos para restablecer tu contraseña</p>
    </div>

    <div class="p-8">
      <mat-horizontal-stepper [linear]="true" #stepper class="custom-stepper">
        
        <mat-step [stepControl]="emailForm" class="pb-6">
          <ng-template matStepLabel class="text-gray-700">
            <div class="flex items-center">
              <mat-icon class="mr-2">mail</mat-icon>
              <span>Ingresa tu correo</span>
            </div>
          </ng-template>
          
          <form [formGroup]="emailForm" class="space-y-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Correo Electrónico *
              </label>
              <div class="relative">
                <mat-icon class="absolute left-3 top-3 text-gray-400">mail_outline</mat-icon>
                <input 
                  type="email"
                  placeholder="usuario@dominio.com"
                  formControlName="email"
                  class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                  [class.border-red-500]="emailForm.get('email')?.invalid && emailForm.get('email')?.touched"
                  [class.focus:ring-red-500]="emailForm.get('email')?.invalid && emailForm.get('email')?.touched"
                  [class.focus:border-red-500]="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
              </div>
              <div *ngIf="emailForm.get('email')?.touched && emailForm.get('email')?.invalid" class="mt-2 text-sm text-red-600">
                Ingresa un correo válido
              </div>
            </div>

            <div [matTooltip]="emailForm.invalid ? 'Ingresa un correo válido para continuar' : ''" 
                 class="pt-4">
              <button mat-raised-button 
                      color="primary" 
                      class="w-full py-3 text-lg font-semibold transition-all duration-300 hover:shadow-lg"
                      [disabled]="emailForm.invalid" 
                      (click)="save(stepper)">
                <mat-icon class="mr-2">arrow_forward</mat-icon>
                Siguiente
              </button>
            </div>
          </form>
        </mat-step>

        <mat-step [stepControl]="resetForm" class="pb-6">
          <ng-template matStepLabel>
            <div class="flex items-center">
              <mat-icon class="mr-2">lock</mat-icon>
              <span>Cambiar Contraseña</span>
            </div>
          </ng-template>
          
          <form [formGroup]="resetForm" class="space-y-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Código de verificación *
              </label>
              <div class="relative">
                <mat-icon class="absolute left-3 top-3 text-gray-400">vpn_key</mat-icon>
                <input 
                  type="text"
                  placeholder="Ingresa el código enviado"
                  formControlName="codigo"
                  class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                  [class.border-red-500]="resetForm.get('codigo')?.invalid && resetForm.get('codigo')?.touched"
                  [class.focus:ring-red-500]="resetForm.get('codigo')?.invalid && resetForm.get('codigo')?.touched"
                  [class.focus:border-red-500]="resetForm.get('codigo')?.invalid && resetForm.get('codigo')?.touched">
              </div>
              <div *ngIf="resetForm.get('codigo')?.touched && resetForm.get('codigo')?.invalid" class="mt-2 text-sm text-red-600">
                Ingresa el código de verificación
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Nueva Contraseña *
              </label>
              <div class="relative">
                <mat-icon class="absolute left-3 top-3 text-gray-400">lock</mat-icon>
                <input 
                  type="password"
                  placeholder="••••••••"
                  formControlName="password"
                  class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                  [class.border-red-500]="resetForm.get('password')?.invalid && resetForm.get('password')?.touched"
                  [class.focus:ring-red-500]="resetForm.get('password')?.invalid && resetForm.get('password')?.touched"
                  [class.focus:border-red-500]="resetForm.get('password')?.invalid && resetForm.get('password')?.touched">
              </div>
              <div *ngIf="resetForm.get('password')?.touched && resetForm.get('password')?.invalid" class="mt-2 text-sm text-red-600 space-y-1">
                <div *ngIf="resetForm.get('password')?.errors?.['required']">Ingresa una contraseña</div>
                <div *ngIf="resetForm.get('password')?.errors?.['minlength']">Debe tener al menos 8 caracteres</div>
                <div *ngIf="resetForm.get('password')?.errors?.['uppercase']">Debe tener al menos una letra mayúscula</div>
                <div *ngIf="resetForm.get('password')?.errors?.['number']">Debe tener al menos un número</div>
                <div *ngIf="resetForm.get('password')?.errors?.['special']">Debe tener al menos un carácter especial</div>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Repetir Contraseña *
              </label>
              <div class="relative">
                <mat-icon class="absolute left-3 top-3 text-gray-400">lock_reset</mat-icon>
                <input 
                  type="password"
                  placeholder="••••••••"
                  formControlName="repetirPassword"
                  class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                  [class.border-red-500]="resetForm.get('repetirPassword')?.invalid && resetForm.get('repetirPassword')?.touched"
                  [class.focus:ring-red-500]="resetForm.get('repetirPassword')?.invalid && resetForm.get('repetirPassword')?.touched"
                  [class.focus:border-red-500]="resetForm.get('repetirPassword')?.invalid && resetForm.get('repetirPassword')?.touched">
              </div>
              <div *ngIf="resetForm.get('repetirPassword')?.touched && resetForm.get('repetirPassword')?.invalid" class="mt-2 text-sm text-red-600 space-y-1">
                <div *ngIf="resetForm.get('repetirPassword')?.errors?.['required']">Repite la contraseña</div>
                <div *ngIf="resetForm.get('repetirPassword')?.errors?.['mismatch']">Las contraseñas no coinciden</div>
              </div>
            </div>

            <div [matTooltip]="resetForm.invalid ? 'Completa todos los campos para cambiar la contraseña' : ''" 
                 class="pt-4">
              <button mat-raised-button 
                      color="primary" 
                      class="w-full py-3 text-lg font-semibold transition-all duration-300 hover:shadow-lg"
                      [disabled]="resetForm.invalid" 
                      (click)="save2()">
                <mat-icon class="mr-2">check_circle</mat-icon>
                Cambiar Contraseña
              </button>
            </div>
          </form>
        </mat-step>

      </mat-horizontal-stepper>

      <div class="text-center pt-6 border-t border-gray-200 mt-6">
        <p class="text-gray-600">
          ¿Recordaste tu contraseña?
          <a (click)="navigateTo('/login')" 
             class="ml-2 text-blue-600 font-semibold hover:text-blue-800 hover:underline cursor-pointer transition-colors">
            Iniciar sesión
          </a>
        </p>
      </div>
    </div>
  </mat-card>
</div>

<app-loading [loading]="isLoading"></app-loading>