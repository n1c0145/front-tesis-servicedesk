<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4 md:p-6">
  <div class="flex items-center gap-2 mb-6 p-3 bg-white rounded-lg shadow-sm border border-gray-200">
    <a [routerLink]="['/home']" class="no-underline">
      <button mat-button color="primary" class="rounded-full px-3 py-1 hover:bg-blue-50 transition-colors">
        <mat-icon class="mr-1 text-base">home</mat-icon>
        Inicio
      </button>
    </a>

    <mat-icon class="text-gray-400">chevron_right</mat-icon>

    <button mat-button disabled class="rounded-full px-3 py-1 text-gray-600 font-medium bg-gray-100">
      <mat-icon class="mr-1 text-base">confirmation_number</mat-icon>
      Tickets
    </button>
  </div>

  <div class="flex justify-center">
    <mat-card class="w-full shadow-lg rounded-xl overflow-hidden border border-gray-200">
      <div class="border-b border-gray-200 p-5 bg-gray-50">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
          <div class="flex items-center">
            <div class="bg-gray-100 p-2 rounded-lg mr-3">
              <mat-icon class="text-gray-600">confirmation_number</mat-icon>
            </div>
            <div>
              <h1 class="text-lg font-semibold text-gray-800">Tickets</h1>
              <p class="text-sm text-gray-500">Listado de tickets del sistema</p>
            </div>
          </div>

          <button mat-raised-button color="primary" (click)="navigateTo('/new-ticket')"
            class="bg-gray-700 hover:bg-gray-800 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 hover:shadow-lg flex items-center">
            <mat-icon class="mr-2">add</mat-icon>
            Abrir Ticket
          </button>
        </div>
      </div>

      <div class="p-5">
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Buscar tickets
          </label>
          <div class="relative">
            <mat-icon class="absolute left-3 top-3 text-gray-500">search</mat-icon>
            <input type="text" (keyup)="applyFilter($event)"
              placeholder="Filtra por número, título, estado, prioridad, etc."
              class="w-full pl-11 pr-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gray-400 focus:border-gray-400 outline-none transition-all text-sm"
              #searchInput>
          </div>
        </div>

        <mat-accordion class="mb-6">
          <mat-expansion-panel [disabled]="!areFiltersReady" class="border border-gray-200">
            <mat-expansion-panel-header class="bg-gray-50 hover:bg-gray-100">
              <mat-panel-title class="flex items-center">
                <ng-container *ngIf="areFiltersReady; else loadingFilters">
                  <mat-icon class="mr-2 text-gray-600 text-base">filter_alt</mat-icon>
                  <span class="font-medium text-gray-700">Filtros Avanzados</span>
                </ng-container>

                <ng-template #loadingFilters>
                  <div class="flex items-center">
                    <mat-icon class="mr-2 text-gray-400 text-base">hourglass_empty</mat-icon>
                    <span class="text-gray-500">Cargando filtros...</span>
                  </div>
                </ng-template>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="p-4 bg-white">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Proyecto
                  </label>
                  <div class="relative">
                    <mat-icon class="absolute left-3 top-3 text-gray-500 z-10 pointer-events-none">folder</mat-icon>
                    <mat-select [(ngModel)]="selectedProjectId"
                      class="w-full pl-11 pr-10 py-2.5 border border-gray-300 rounded-md bg-white hover:bg-gray-50 text-sm text-gray-700 focus:ring-2 focus:ring-gray-400 focus:border-gray-400 outline-none transition-all cursor-pointer"
                      panelClass="custom-select-panel">
                      <mat-option *ngFor="let project of projects" [value]="project.id"
                        class="text-sm py-2 hover:bg-gray-100">
                        {{ project.nombre }}
                      </mat-option>
                    </mat-select>
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Asignado a
                  </label>
                  <div class="relative">
                    <mat-icon class="absolute left-3 top-3 text-gray-500 z-10 pointer-events-none">person</mat-icon>
                    <mat-select [(ngModel)]="selectedUserId"
                      class="w-full pl-11 pr-10 py-2.5 border border-gray-300 rounded-md bg-white hover:bg-gray-50 text-sm text-gray-700 focus:ring-2 focus:ring-gray-400 focus:border-gray-400 outline-none transition-all cursor-pointer"
                      panelClass="custom-select-panel">
                      <mat-option *ngFor="let user of users" [value]="user.id" class="text-sm py-2 hover:bg-gray-100">
                        {{ user.user }}
                      </mat-option>
                    </mat-select>
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Creado por
                  </label>
                  <div class="relative">
                    <mat-icon class="absolute left-3 top-3 text-gray-500 z-10 pointer-events-none">person_add</mat-icon>
                    <mat-select [(ngModel)]="selectedCreatedById"
                      class="w-full pl-11 pr-10 py-2.5 border border-gray-300 rounded-md bg-white hover:bg-gray-50 text-sm text-gray-700 focus:ring-2 focus:ring-gray-400 focus:border-gray-400 outline-none transition-all cursor-pointer"
                      panelClass="custom-select-panel">
                      <mat-option *ngFor="let user of users" [value]="user.id" class="text-sm py-2 hover:bg-gray-100">
                        {{ user.user }}
                      </mat-option>
                    </mat-select>
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Estado
                  </label>
                  <div class="relative">
                    <mat-icon class="absolute left-3 top-3 text-gray-500 z-10 pointer-events-none">circle</mat-icon>
                    <mat-select [(ngModel)]="selectedStatusId"
                      class="w-full pl-11 pr-10 py-2.5 border border-gray-300 rounded-md bg-white hover:bg-gray-50 text-sm text-gray-700 focus:ring-2 focus:ring-gray-400 focus:border-gray-400 outline-none transition-all cursor-pointer"
                      panelClass="custom-select-panel">
                      <mat-option *ngFor="let s of statuses" [value]="s.id" class="text-sm py-2 hover:bg-gray-100">
                        {{ s.nombre }}
                      </mat-option>
                    </mat-select>
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Prioridad
                  </label>
                  <div class="relative">
                    <mat-icon
                      class="absolute left-3 top-3 text-gray-500 z-10 pointer-events-none">priority_high</mat-icon>
                    <mat-select [(ngModel)]="selectedPriorityId"
                      class="w-full pl-11 pr-10 py-2.5 border border-gray-300 rounded-md bg-white hover:bg-gray-50 text-sm text-gray-700 focus:ring-2 focus:ring-gray-400 focus:border-gray-400 outline-none transition-all cursor-pointer"
                      panelClass="custom-select-panel">
                      <mat-option *ngFor="let p of priorities" [value]="p.id" class="text-sm py-2 hover:bg-gray-100">
                        {{ p.nombre }}
                      </mat-option>
                    </mat-select>
                  </div>
                </div>

                <div class="md:col-span-2">
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Rango de fechas
                  </label>
                  <div class="relative">
                    <mat-icon
                      class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 z-10 pointer-events-none text-sm">
                      calendar_today
                    </mat-icon>

                    <div class="custom-date-range">
                      <mat-date-range-input [rangePicker]="picker"
                        class="w-full pl-10 pr-10 border border-gray-300 rounded-md bg-white hover:bg-gray-50 text-sm text-gray-700 focus-within:ring-2 focus-within:ring-gray-400 focus-within:border-gray-400 outline-none transition-all">
                        <input matStartDate placeholder="Desde" [(ngModel)]="dateRange.start" name="startDate" />
                        <input matEndDate placeholder="Hasta" [(ngModel)]="dateRange.end" name="endDate" />
                      </mat-date-range-input>
                    </div>

                    <mat-datepicker-toggle matSuffix [for]="picker"
                      class="absolute right-2 top-1/2 transform -translate-y-1/2">
                      <mat-icon class="text-gray-400 hover:text-gray-600 text-sm">calendar_today</mat-icon>
                    </mat-datepicker-toggle>
                    <mat-date-range-picker #picker></mat-date-range-picker>
                  </div>
                </div>
              </div>

              <div class="flex flex-wrap gap-3 mt-6 pt-4 border-t border-gray-200">
                <button mat-raised-button color="primary" (click)="applyFilters()"
                  class="bg-gray-700 hover:bg-gray-800 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 hover:shadow-lg flex items-center">
                  <mat-icon class="mr-2 text-sm">filter_alt</mat-icon>
                  Aplicar filtros
                </button>
                <button mat-stroked-button color="warn" (click)="clearFilters()"
                  class="border-gray-300 text-gray-700 hover:bg-gray-50 font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center">
                  <mat-icon class="mr-2 text-sm">clear_all</mat-icon>
                  Borrar filtros
                </button>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>

        <div class="overflow-x-auto rounded-lg border border-gray-200">
          <table mat-table [dataSource]="dataSource" matSort class="w-full min-w-max">

            <ng-container matColumnDef="ticket_number">
              <th mat-header-cell *matHeaderCellDef mat-sort-header
                class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider bg-gray-50">
                <div class="flex items-center">
                  <mat-icon class="mr-2 text-base text-gray-500">tag</mat-icon>
                  Número
                </div>
              </th>
              <td mat-cell *matCellDef="let ticket" class="px-4 py-3 text-sm">
                <a href="javascript:void(0)" (click)="openTicket(ticket.id)"
                  class="text-blue-600 hover:text-blue-800 hover:underline cursor-pointer font-medium flex items-center">
                  <mat-icon class="mr-2 text-sm text-blue-500">open_in_new</mat-icon>
                  {{ ticket.ticket_number }}
                </a>
              </td>
            </ng-container>

            <ng-container matColumnDef="titulo">
              <th mat-header-cell *matHeaderCellDef mat-sort-header
                class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider bg-gray-50">
                <div class="flex items-center">
                  <mat-icon class="mr-2 text-base text-gray-500">title</mat-icon>
                  Título
                </div>
              </th>
              <td mat-cell *matCellDef="let ticket" class="px-4 py-3 text-sm text-gray-900">
                <div class="flex items-start">
                  <mat-icon class="mr-2 text-gray-400 text-sm mt-0.5">description</mat-icon>
                  <span class="line-clamp-2">{{ ticket.titulo }}</span>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="prioridad">
              <th mat-header-cell *matHeaderCellDef mat-sort-header
                class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider bg-gray-50">
                <div class="flex items-center">
                  <mat-icon class="mr-2 text-base text-gray-500">priority_high</mat-icon>
                  Prioridad
                </div>
              </th>
              <td mat-cell *matCellDef="let ticket" class="px-4 py-3 text-sm">
                <div class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium"
                  [class.bg-red-100]="ticket.prioridad === 'Alta'" [class.text-red-800]="ticket.prioridad === 'Alta'"
                  [class.bg-yellow-100]="ticket.prioridad === 'Media'"
                  [class.text-yellow-800]="ticket.prioridad === 'Media'"
                  [class.bg-green-100]="ticket.prioridad === 'Baja'"
                  [class.text-green-800]="ticket.prioridad === 'Baja'" [class.bg-gray-100]="!ticket.prioridad"
                  [class.text-gray-800]="!ticket.prioridad">
                  <mat-icon class="mr-1 text-xs">flag</mat-icon>
                  {{ ticket.prioridad || 'No definida' }}
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="estado">
              <th mat-header-cell *matHeaderCellDef mat-sort-header
                class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider bg-gray-50">
                <div class="flex items-center">
                  <mat-icon class="mr-2 text-base text-gray-500">circle</mat-icon>
                  Estado
                </div>
              </th>
              <td mat-cell *matCellDef="let ticket" class="px-4 py-3 text-sm">
                <div class="flex items-center">
                  <div class="w-2 h-2 rounded-full mr-2"
                    [class.bg-green-500]="ticket.estado === 'Abierto' || ticket.estado === 'En Proceso'"
                    [class.bg-blue-500]="ticket.estado === 'Pendiente'"
                    [class.bg-gray-500]="ticket.estado === 'Cerrado' || ticket.estado === 'Resuelto'">
                  </div>
                  <span class="font-medium text-gray-700">
                    {{ ticket.estado }}
                  </span>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="created_by">
              <th mat-header-cell *matHeaderCellDef mat-sort-header
                class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider bg-gray-50">
                <div class="flex items-center">
                  <mat-icon class="mr-2 text-base text-gray-500">person</mat-icon>
                  Abierto por
                </div>
              </th>
              <td mat-cell *matCellDef="let ticket" class="px-4 py-3 text-sm">
                <a href="javascript:void(0)" (click)="filterByAssigned(ticket.created_by_id, ticket.created_by)"
                  class="text-blue-600 hover:text-blue-800 hover:underline cursor-pointer flex items-center">
                  <mat-icon class="mr-2 text-sm text-gray-400">person_outline</mat-icon>
                  {{ ticket.created_by }}
                </a>
              </td>
            </ng-container>

            <ng-container matColumnDef="created_at">
              <th mat-header-cell *matHeaderCellDef mat-sort-header
                class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider bg-gray-50">
                <div class="flex items-center">
                  <mat-icon class="mr-2 text-base text-gray-500">calendar_today</mat-icon>
                  Fecha
                </div>
              </th>
              <td mat-cell *matCellDef="let ticket" class="px-4 py-3 text-sm text-gray-900">
                <div class="flex items-center">
                  <mat-icon class="mr-2 text-gray-400 text-sm">access_time</mat-icon>
                  {{ ticket.created_at | date: 'short' }}
                </div>
              </td>
            </ng-container>

            <tr *matNoDataRow class="bg-white">
              <td class="px-4 py-8 text-center text-gray-500" [attr.colspan]="displayedColumns.length">
                <div class="flex flex-col items-center justify-center">
                  <mat-icon class="text-4xl text-gray-300 mb-2">confirmation_number</mat-icon>
                  <p class="text-lg font-medium text-gray-700">No se encontraron tickets</p>
                  <p class="text-sm text-gray-500 mt-1">
                    {{ searchInput.value ? 'Intenta con otros términos de búsqueda' : 'No hay tickets creados' }}
                  </p>
                  <button mat-raised-button color="primary" (click)="navigateTo('/new-ticket')"
                    class="mt-4 bg-gray-700 hover:bg-gray-800">
                    <mat-icon class="mr-2">add</mat-icon>
                    Abrir primer ticket
                  </button>
                </div>
              </td>
            </tr>

            <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"
              class="bg-white hover:bg-gray-50 border-b border-gray-200"></tr>
          </table>
        </div>

        <div class="mt-4 bg-white p-4 rounded-lg border border-gray-200">
          <mat-paginator [pageSizeOptions]="[25, 50, 100]" showFirstLastButtons class="custom-paginator">
          </mat-paginator>
        </div>
      </div>
    </mat-card>
  </div>
</div>

<app-loading [loading]="isLoading"></app-loading>